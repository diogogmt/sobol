br
a#addEstimate.btn(href='#newEstimate') Add Estimate
div(style='display: none;')
  #newEstimate(style='width: 400px; height: 150px; overflow: auto;')
    h4 Add Estimate
    form.form.label-inline(id='addEstimateForm', action='/estimate/add/#{job.id}', method='post')
      table
        tr
          td
            .field
              label(for='name') Name
              input#name.medium(name='estimate[name]', size='20', type='text', value='')
        tr
          td
            input#saveEstimate.btn(type='submit', value='Add')
table#estimateTable.display(cellpadding='0', cellspacing='0', border='0', rel='datatable')
  thead
    tr
      th ID
      th Name
      th Final Total
      th Created On
      th Status
  tbody

script(type="text/javascript")
  $(document).ready(function() {
    $("#addEstimate").fancybox({
      'titlePosition'   : 'inside',
      'transitionIn'    : 'none',
      'transitionOut'   : 'none'
    });
    var dTable = $("#estimateTable").dataTable( {
      "bProcessing": true,
      "bDestroy": true,
      "sAjaxSource": "/datatable/job/" + "#{job.id}" + "/estimates",
      "aoColumnDefs": [
        { "bVisible" : false, "aTargets" : [0] }
      ],
      "aaSorting": [[3, "desc"]]
    });
    $("#estimateTable tbody tr").live("click", function() {
      var data = dTable.fnGetData(this);
      var estimateID = data[0];
      var jobID = "#{job.id}";
      window.location = "/job/" + jobID + "/estimate/" + estimateID;
    });
    if('#{job.PID}' > 0 || '#{job.status}' == "Inactive") {
      $("#addEstimate").toggle();
    }
  });
